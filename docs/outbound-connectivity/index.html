<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Azure Local Outbound Connectivity - Architecture Guide</title>
    <!-- Firebase SDK for Analytics -->
    <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-database-compat.js"></script>
    <link rel="stylesheet" href="styles.css">
    <link href="https://fonts.googleapis.com/css2?family=Segoe+UI:wght@300;400;600;700&display=swap" rel="stylesheet">
</head>
<body>
    <!-- Tab Navigation (consistent with main site) -->
    <nav class="odin-tab-nav">
        <div class="odin-tab-container">
            <a href="../../index.html" class="odin-tab-logo">
                <img src="images/odin-logo.png" alt="Odin">
                <span>ODIN</span>
            </a>
            <a href="../../index.html" class="odin-tab-btn" data-tab="designer">
                <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                    <rect x="3" y="3" width="18" height="18" rx="2"/>
                    <path d="M3 9h18M9 21V9"/>
                </svg>
                Designer
            </a>
            <a href="#" class="odin-tab-btn active" data-tab="knowledge">
                <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                    <path d="M4 19.5A2.5 2.5 0 0 1 6.5 17H20"/>
                    <path d="M6.5 2H20v20H6.5A2.5 2.5 0 0 1 4 19.5v-15A2.5 2.5 0 0 1 6.5 2z"/>
                </svg>
                Knowledge
            </a>
            <a href="../../sizer/index.html" class="odin-tab-btn" data-tab="sizer">
                <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                    <path d="M3 3v18h18"/>
                    <path d="M18 17V9"/>
                    <path d="M13 17V5"/>
                    <path d="M8 17v-3"/>
                </svg>
                Sizer
                <span class="odin-tab-badge">Preview</span>
            </a>
            <button onclick="toggleTheme()" id="theme-toggle" class="nav-theme-toggle" title="Toggle light/dark theme">üåô</button>
        </div>
    </nav>

    <nav class="sidebar">
        <div class="sidebar-header">
            <h2>Odin for Azure Local</h2>
            <p>Outbound Connectivity Guide</p>
            <span class="version-badge">v1.0</span>
        </div>
        <ul class="nav-links">
            <li><a href="#overview" class="active">Overview</a></li>
            <li><a href="#comparison">Architecture Comparison</a></li>
            <li><a href="#when-to-use">When to Use</a></li>
            <li><a href="#private-endpoints">Private Endpoints Scenarios</a></li>
            <li><a href="#reserved-subnets">Reserved Subnets (ARB/AKS)</a></li>
            <li><a href="#traffic-flows-comparison">Traffic Flows Comparison</a></li>
            <li><a href="#traffic-categories">Traffic Categories</a></li>
            <li><a href="#aks-subnet">AKS Subnet Requirements</a></li>
            <li><a href="#configuration">Configuration</a></li>
        </ul>
    </nav>

    <main class="content">
        <!-- Overview Section -->
        <section id="overview" class="section">
            <h1>Azure Local Outbound Connectivity</h1>
            <p class="subtitle">Comprehensive Guide to Public Path vs Private Path Architectures</p>
            
            <div class="intro-card">
                <h3>What You'll Learn</h3>
                <ul>
                    <li><strong>Architecture Components:</strong> Understanding core components including Azure Local machines, Arc Gateway, proxies, and networking infrastructure</li>
                    <li><strong>Traffic Categorization:</strong> Distinguishing between different types of network traffic and their routing paths</li>
                    <li><strong>Configuration Steps:</strong> Setting up proxies, firewall rules, and Arc Gateway registration</li>
                    <li><strong>Best Practices:</strong> When to use each architecture based on your requirements</li>
                </ul>
            </div>

            <div class="key-benefits">
                <h3>Key Benefits of Arc Gateway</h3>
                <div class="benefits-grid">
                    <div class="benefit-card">
                        <div class="benefit-icon">üîí</div>
                        <h4>Better Security</h4>
                        <p>Fewer open connections reduce the potential attack surface. Reduce firewall rules from hundreds to fewer than 30 endpoints.</p>
                    </div>
                    <div class="benefit-card">
                        <div class="benefit-icon">‚öôÔ∏è</div>
                        <h4>Easier Setup</h4>
                        <p>Leverage your existing network and security infrastructure while the Arc Gateway manages Azure connectivity.</p>
                    </div>
                    <div class="benefit-card">
                        <div class="benefit-icon">üìä</div>
                        <h4>Simpler Management</h4>
                        <p>Fewer endpoints to manage means easier tracking and troubleshooting.</p>
                    </div>
                </div>
            </div>
        </section>

        <!-- Architecture Comparison Section -->
        <section id="comparison" class="section">
            <h2>Architecture Comparison</h2>
            
            <div class="comparison-intro">
                <p>Azure Local supports two primary outbound connectivity models. Arc Gateway is recommended to simplify and secure connectivity, but the key difference is how traffic reaches Azure services.</p>
            </div>

            <div class="architecture-cards">
                <div class="arch-card public">
                    <div class="arch-header">
                        <h3>üåê Public Path</h3>
                        <span class="badge">4 Options</span>
                    </div>
                    <div class="arch-body">
                        <p>Traffic routes to Azure via <strong>public internet</strong>. Multiple configuration options available:</p>
                        <ul>
                            <li><strong>Option 1:</strong> No Proxy, No Arc Gateway - <a href="https://learn.microsoft.com/en-us/azure/azure-local/deploy/deployment-without-azure-arc-gateway?view=azloc-2601&tabs=script&pivots=register-proxy" target="_blank">How to register nodes in Arc ‚Üó</a></li>
                            <li><strong>Option 2:</strong> Proxy, No Arc Gateway - <a href="https://learn.microsoft.com/en-us/azure/azure-local/deploy/deployment-without-azure-arc-gateway?view=azloc-2601&tabs=script&pivots=register-proxy" target="_blank">How to register nodes in Arc ‚Üó</a></li>
                            <li><strong>Option 3:</strong> No Proxy, Arc Gateway - <a href="https://learn.microsoft.com/en-us/azure/azure-local/deploy/deployment-with-azure-arc-gateway?view=azloc-2601&tabs=script&pivots=register-proxy" target="_blank">How to register nodes in Arc ‚Üó</a></li>
                            <li><strong>Option 4:</strong> Proxy + Arc Gateway - <a href="https://learn.microsoft.com/en-us/azure/azure-local/deploy/deployment-with-azure-arc-gateway?view=azloc-2601&tabs=script&pivots=register-proxy" target="_blank">How to register nodes in Arc ‚Üó</a></li>
                        </ul>
                    </div>
                </div>
                <!-- PRIVATE-PATH-PREVIEW: Remove this comment and the preview-banner div when Private Path is GA -->
                <div class="arch-card private">
                    <div class="preview-banner private-path-preview">
                        <span class="preview-icon">üöß</span>
                        <span><strong>Coming Soon:</strong> Private Path is an upcoming feature not yet supported. Documentation is provided for planning purposes.</span>
                    </div>
                    <div class="arch-header">
                        <h3>üîê Private Path</h3>
                        <span class="badge">Enhanced Security</span>
                    </div>
                    <div class="arch-body">
                        <p>Traffic routes through Arc Gateway via <strong>ExpressRoute or Site-to-Site VPN</strong>.</p>
                        <ul>
                            <li>Azure Firewall Explicit Proxy</li>
                            <li>No public internet exposure</li>
                            <li>Private connectivity to Azure</li>
                        </ul>
                    </div>
                </div>
            </div>

            <h3>Detailed Comparison</h3>
            <table class="comparison-table">
                <thead>
                    <tr>
                        <th>Aspect</th>
                        <th>Public Path</th>
                        <th>Private Path</th>
                    </tr>
                </thead>
                <tbody>
                    <tr>
                        <td><strong>Internet Exposure</strong></td>
                        <td>Required (outbound)</td>
                        <td>None</td>
                    </tr>
                    <tr>
                        <td><strong>Primary Connectivity</strong></td>
                        <td>Public endpoints via Arc Gateway</td>
                        <td>ExpressRoute or Site-to-Site VPN</td>
                    </tr>
                    <tr>
                        <td><strong>Enterprise Proxy Location</strong></td>
                        <td>On-premises (optional)</td>
                        <td>Azure Firewall Explicit Proxy (in Azure)</td>
                    </tr>
                    <tr>
                        <td><strong>Firewall Location</strong></td>
                        <td>On-premises firewall</td>
                        <td>Azure Firewall (in Azure VNET)</td>
                    </tr>
                    <tr>
                        <td><strong>Arc Gateway</strong></td>
                        <td>‚úÖ Optional (recommended)</td>
                        <td>‚úÖ Yes</td>
                    </tr>
                    <tr>
                        <td><strong>Cluster IP:40343</strong></td>
                        <td>‚úÖ For ARB/AKS</td>
                        <td>‚úÖ For ARB/AKS</td>
                    </tr>
                    <tr>
                        <td><strong>Private Endpoints</strong></td>
                        <td>‚úÖ Supported</td>
                        <td>‚úÖ Supported</td>
                    </tr>
                    <tr>
                        <td style="padding-left: 2rem;">ÔøΩ Arc Private Link</td>
                        <td>‚ùå</td>
                        <td>‚ùå</td>
                    </tr>
                    <tr>
                        <td style="padding-left: 2rem;">üîê Key Vault</td>
                        <td>‚úÖ</td>
                        <td>‚úÖ</td>
                    </tr>
                    <tr>
                        <td style="padding-left: 2rem;">üíæ Storage (Blob)</td>
                        <td>‚úÖ</td>
                        <td>‚úÖ</td>
                    </tr>
                    <tr>
                        <td style="padding-left: 2rem;">üì¶ Azure Container Registry</td>
                        <td>‚úÖ</td>
                        <td>‚úÖ</td>
                    </tr>
                    <tr>
                        <td style="padding-left: 2rem;">üîÑ Azure Site Recovery</td>
                        <td>‚úÖ</td>
                        <td>‚úÖ</td>
                    </tr>
                    <tr>
                        <td style="padding-left: 2rem;">üóÑÔ∏è Recovery Services Vault (Backup)</td>
                        <td>‚úÖ</td>
                        <td>‚úÖ</td>
                    </tr>
                    <tr>
                        <td style="padding-left: 2rem;">üóÉÔ∏è SQL Managed Instance</td>
                        <td>‚úÖ</td>
                        <td>‚úÖ</td>
                    </tr>
                    <tr>
                        <td style="padding-left: 2rem;">üõ°Ô∏è Microsoft Defender for Cloud</td>
                        <td>‚úÖ</td>
                        <td>‚úÖ</td>
                    </tr>
                    <tr>
                        <td><strong>TLS Inspection</strong></td>
                        <td>‚ùå Not supported</td>
                        <td>‚ùå Not supported</td>
                    </tr>
                    <tr>
                        <td><strong>Setup Complexity</strong></td>
                        <td>Lower</td>
                        <td>Higher</td>
                    </tr>
                    <tr>
                        <td><strong>Cost</strong></td>
                        <td>Lower</td>
                        <td>Higher (ExpressRoute + Azure Firewall)</td>
                    </tr>
                </tbody>
            </table>

            <div class="info-box">
                <h4>üìå Important Note on Private Endpoints</h4>
                <p><strong>Private Endpoints (Private Link) are architecture-agnostic.</strong> They work identically in both Public Path and Private Path architectures. The configuration is the same - you add Private Link endpoints to the proxy bypass list so traffic goes directly to them.</p>
            </div>

            <h3>Components Overview</h3>
            <div class="flow-comparison-grid">
                <div class="flow-column public">
                    <h4>üåê Public Path</h4>
                    <p>Traffic routed through the Arc Gateway to Azure services via the <strong>public internet</strong>. Your on-premises enterprise proxy and firewall control the traffic flow.</p>
                    <div class="diagram-container">
                        <img src="images/public-path-step-0-components.svg" 
                             alt="Public Path - Components Overview" 
                             class="diagram">
                        <div class="diagram-fallback" style="display:none;">
                            <p>Diagram showing Azure Local components for Public Path.</p>
                        </div>
                    </div>
                </div>
                <div class="flow-column private">
                    <h4>üîê Private Path</h4>
                    <p>Traffic routed <strong>securely through private connections</strong> (ExpressRoute or Site-to-Site VPN) to Azure, eliminating public internet exposure.</p>
                    <div class="diagram-container private-path">
                        <img src="images/private-path-step-0-components.svg" 
                             alt="Private Path - Components Overview" 
                             class="diagram">
                    </div>
                </div>
            </div>

            <div class="highlight-box">
                <h4>üîê What Makes Private Path "Private"</h4>
                <ol>
                    <li><strong>Azure Firewall Explicit Proxy</strong> is the enterprise proxy (hosted in Azure, not on-prem)</li>
                    <li><strong>Arc Gateway</strong> routes through private connection (ExpressRoute/VPN)</li>
                    <li><strong>No public internet exposure</strong> for Azure Local traffic</li>
                    <li><strong>Unified private connectivity</strong> ‚Äî combine private endpoints for Azure PaaS services (Storage, Key Vault, etc.) with fully private Arc and Entra traffic over ExpressRoute</li>
                </ol>
            </div>

            <div class="highlight-box">
                <h4>üåê What Makes Public Path "Public"</h4>
                <ol>
                    <li><strong>On-premises Enterprise Proxy</strong> handles all outbound traffic from Azure Local</li>
                    <li><strong>Arc Gateway</strong> routes through the public internet to Azure services</li>
                    <li><strong>Enterprise firewall</strong> controls and inspects traffic before leaving your network</li>
                    <li><strong>Hybrid private endpoints</strong> ‚Äî while Arc and Entra traffic uses public internet, you can still use private endpoints for Azure PaaS services (Storage, Key Vault) if you have ExpressRoute or Site-to-Site VPN connectivity</li>
                </ol>
            </div>
        </section>

        <!-- When to Use Section -->
        <section id="when-to-use" class="section">
            <h2>When to Use Each Architecture</h2>

            <div class="decision-grid">
                <div class="decision-card public">
                    <h3>Choose Public Path When:</h3>
                    <ul>
                        <li>‚úÖ You have reliable internet connectivity</li>
                        <li>‚úÖ You already have on-premises proxy/firewall infrastructure</li>
                        <li>‚úÖ Public internet egress is acceptable per your security policies</li>
                        <li>‚úÖ Simpler initial setup is preferred</li>
                        <li>‚úÖ Cost optimization (no ExpressRoute/VPN required)</li>
                    </ul>
                </div>

                <div class="decision-card private">
                    <h3>Choose Private Path When:</h3>
                    <ul>
                        <li>‚úÖ <strong>Zero public internet exposure</strong> is required</li>
                        <li>‚úÖ Regulatory/compliance requirements mandate private connectivity</li>
                        <li>‚úÖ You already have ExpressRoute or Site-to-Site VPN</li>
                        <li>‚úÖ Centralized Azure-based security management is preferred</li>
                        <li>‚úÖ High-security environments (government, healthcare, financial)</li>
                    </ul>
                </div>
            </div>

            <h3>Summary</h3>
            <div class="summary-box">
                <p>Both architectures can leverage the <strong>Arc Gateway</strong> to reduce firewall rules from hundreds to fewer than 30 endpoints. The key differentiator is:</p>
                <ul>
                    <li><strong>Public Path:</strong> Uses on-premises proxy/firewall with public internet egress</li>
                    <li><strong>Private Path:</strong> Uses Azure Firewall Explicit Proxy with ExpressRoute/VPN (no public internet)</li>
                </ul>
                <p><strong>Private Endpoints</strong> are configured identically in both architectures - they're architecture-agnostic.</p>
            </div>
        </section>

        <!-- Private Endpoints Scenarios Section -->
        <section id="private-endpoints" class="section">
            <h2>Private Endpoints Usage Across Deployment Scenarios</h2>
            
            <p>Azure Local supports multiple deployment scenarios with varying proxy and Arc Gateway configurations. Private Endpoints (Private Link) work across all scenarios but require proper proxy bypass configuration.</p>

            <div class="scenarios-overview">
                <div class="path-column">
                    <h3 class="public-header">üåê Public Path - 4 Options</h3>
                    <p>When using public internet for Azure connectivity, you have four deployment options:</p>
                    
                    <!-- Option 1: No Proxy, No Arc Gateway -->
                    <div class="scenario-card">
                        <div class="scenario-header option1">
                            <span class="option-number">1</span>
                            <h4>No Proxy, No Arc Gateway</h4>
                        </div>
                        <div class="scenario-content">
                            <p>Direct connection to Azure through firewall only. Requires opening all Azure endpoints in firewall.</p>
                            <div class="diagram-container public-scenario">
                                <img src="images/public-path-no-proxy-no-arc-gateway.svg" 
                                     alt="No Proxy, No Arc Gateway" 
                                     class="diagram">
                            </div>
                            <div class="private-path-details">
                                <h5>Key Characteristics:</h5>
                                <ul>
                                    <li><strong>Proxy:</strong> None</li>
                                    <li><strong>Arc Gateway:</strong> Not used</li>
                                    <li><strong>Connectivity:</strong> Direct to public internet</li>
                                    <li><strong>Firewall Rules:</strong> Hundreds of endpoints required</li>
                                </ul>
                            </div>
                            <div class="scenario-pros-cons">
                                <div class="pros">
                                    <strong>‚úÖ Simplest setup</strong>
                                    <p>No proxy configuration needed</p>
                                </div>
                                <div class="cons">
                                    <strong>‚ùå Most firewall rules</strong>
                                    <p>Hundreds of endpoints to manage</p>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Option 2: Proxy, No Arc Gateway -->
                    <div class="scenario-card">
                        <div class="scenario-header option2">
                            <span class="option-number">2</span>
                            <h4>Proxy, No Arc Gateway</h4>
                        </div>
                        <div class="scenario-content">
                            <p>Traffic routes through enterprise proxy. Proxy handles URL filtering and logging.</p>
                            <div class="diagram-container public-scenario">
                                <img src="images/public-path-proxy-no-arc-gateway.svg" 
                                     alt="Proxy, No Arc Gateway" 
                                     class="diagram">
                            </div>
                            <div class="private-path-details">
                                <h5>Key Characteristics:</h5>
                                <ul>
                                    <li><strong>Proxy:</strong> On-premises enterprise proxy</li>
                                    <li><strong>Arc Gateway:</strong> Not used</li>
                                    <li><strong>Connectivity:</strong> Through proxy to public internet</li>
                                    <li><strong>Firewall Rules:</strong> Many endpoints required</li>
                                </ul>
                            </div>
                            <div class="scenario-pros-cons">
                                <div class="pros">
                                    <strong>‚úÖ Centralized control</strong>
                                    <p>Proxy provides visibility and filtering</p>
                                </div>
                                <div class="cons">
                                    <strong>‚ùå Many endpoints</strong>
                                    <p>Still requires many firewall/proxy rules</p>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Option 3: No Proxy, Arc Gateway -->
                    <div class="scenario-card">
                        <div class="scenario-header option3">
                            <span class="option-number">3</span>
                            <h4>No Proxy, Arc Gateway</h4>
                        </div>
                        <div class="scenario-content">
                            <p>Arc Gateway handles Azure connectivity. Reduces firewall rules to fewer than 30 endpoints.</p>
                            <div class="diagram-container public-scenario">
                                <img src="images/public-path-no-proxy-with-arc-gateway.svg" 
                                     alt="No Proxy, Arc Gateway" 
                                     class="diagram">
                            </div>
                            <div class="private-path-details">
                                <h5>Key Characteristics:</h5>
                                <ul>
                                    <li><strong>Proxy:</strong> None</li>
                                    <li><strong>Arc Gateway:</strong> Handles HTTPS traffic to Azure</li>
                                    <li><strong>Connectivity:</strong> Arc Gateway to public internet</li>
                                    <li><strong>Firewall Rules:</strong> Fewer than 30 endpoints</li>
                                </ul>
                            </div>
                            <div class="scenario-pros-cons">
                                <div class="pros">
                                    <strong>‚úÖ Simplified rules</strong>
                                    <p>Fewer than 30 endpoints needed</p>
                                </div>
                                <div class="cons">
                                    <strong>‚ùå No HTTP proxy</strong>
                                    <p>HTTP traffic goes direct to firewall</p>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Option 4: Proxy with Arc Gateway -->
                    <div class="scenario-card">
                        <div class="scenario-header option4">
                            <span class="option-number">4</span>
                            <h4>Proxy with Arc Gateway</h4>
                        </div>
                        <div class="scenario-content">
                            <p>Best of both worlds: Arc Gateway for HTTPS to Azure, enterprise proxy for HTTP and third-party traffic.</p>
                            <div class="diagram-container public-scenario">
                                <img src="images/public-path-with-proxy-and-arc-gateway.svg" 
                                     alt="Proxy with Arc Gateway" 
                                     class="diagram">
                            </div>
                            <div class="private-path-details">
                                <h5>Key Characteristics:</h5>
                                <ul>
                                    <li><strong>Proxy:</strong> On-premises enterprise proxy</li>
                                    <li><strong>Arc Gateway:</strong> Handles HTTPS traffic to Azure</li>
                                    <li><strong>Connectivity:</strong> Arc Gateway + Proxy to public internet</li>
                                    <li><strong>Firewall Rules:</strong> Fewer than 30 endpoints</li>
                                </ul>
                            </div>
                            <div class="scenario-pros-cons">
                                <div class="pros">
                                    <strong>‚úÖ Best security</strong>
                                    <p>Minimal rules + proxy control</p>
                                </div>
                                <div class="pros">
                                    <strong>‚úÖ Full visibility</strong>
                                    <p>All traffic is managed</p>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <div class="path-column">
                    <h3 class="private-header">üîê Private Path - 1 Option</h3>
                    <p>When using ExpressRoute/VPN for private Azure connectivity, there is only one supported configuration:</p>
                    
                    <!-- Only Option: Azure Firewall Explicit Proxy with Arc Gateway -->
                    <div class="scenario-card private-only">
                        <div class="scenario-header private-option">
                            <span class="option-number">‚òÖ</span>
                            <h4>Azure Firewall Explicit Proxy + Arc Gateway</h4>
                            <span class="badge-only">Only Option</span>
                        </div>
                        <div class="scenario-content">
                            <p>All traffic routes through ExpressRoute/VPN to Azure Firewall Explicit Proxy, with Arc Gateway providing the secure tunnel to Azure services.</p>
                            <div class="diagram-container private-scenario">
                                <img src="images/private-path-explicit-proxy-and-arc-gateway.svg" 
                                     alt="Azure Firewall Explicit Proxy with Arc Gateway" 
                                     class="diagram">
                            </div>
                            <div class="private-path-details">
                                <h5>Key Characteristics:</h5>
                                <ul>
                                    <li><strong>Proxy:</strong> Azure Firewall Explicit Proxy (in Azure VNET)</li>
                                    <li><strong>Arc Gateway:</strong> Required for HTTPS traffic to Azure</li>
                                    <li><strong>Connectivity:</strong> ExpressRoute or Site-to-Site VPN</li>
                                    <li><strong>Internet:</strong> No public internet exposure</li>
                                </ul>
                            </div>
                            <div class="scenario-pros-cons">
                                <div class="pros">
                                    <strong>‚úÖ Maximum security</strong>
                                    <p>No public internet exposure</p>
                                </div>
                                <div class="pros">
                                    <strong>‚úÖ Centralized management</strong>
                                    <p>Azure Firewall policies</p>
                                </div>
                                <div class="pros">
                                    <strong>‚úÖ Compliance ready</strong>
                                    <p>Meets strict regulatory requirements</p>
                                </div>
                            </div>
                        </div>
                    </div>

                    <div class="private-path-note">
                        <h4>‚ö†Ô∏è Why Only One Option?</h4>
                        <p>The Private Path architecture requires:</p>
                        <ul>
                            <li><strong>Azure Firewall Explicit Proxy</strong> - to serve as the enterprise proxy hosted in Azure</li>
                            <li><strong>Arc Gateway</strong> - to create secure tunnels for HTTPS traffic</li>
                            <li><strong>ExpressRoute/VPN</strong> - to provide private connectivity</li>
                        </ul>
                        <p>Any variation from this architecture is <strong>not validated or supported</strong> by Microsoft.</p>
                    </div>
                </div>
            </div>

            <div class="pe-summary">
                <h3>Private Endpoints Configuration</h3>
                <p>Regardless of which scenario you choose, Private Endpoints (Private Link) are configured the same way:</p>
                <div class="pe-config-box">
                    <ol>
                        <li>Add Private Link endpoint FQDNs to the <strong>proxy bypass list</strong></li>
                        <li>Configure DNS to resolve Private Link FQDNs to private IPs</li>
                        <li>Traffic flows directly to Private Endpoints without going through proxy or Arc Gateway</li>
                    </ol>
                </div>
            </div>

            <!-- Detailed Private Endpoints by Service -->
            <div class="pe-services-detail">
                <h3>Private Endpoints by Service Type</h3>
                <p>Each Azure service has specific requirements when configuring Private Endpoints with Azure Local:</p>

                <!-- Key Vault -->
                <div class="service-pe-card">
                    <div class="service-pe-header keyvault">
                        <span class="service-icon">üîê</span>
                        <div>
                            <h4>Azure Key Vault</h4>
                            <code>vault.azure.net</code>
                        </div>
                    </div>
                    <div class="service-pe-content">
                        <p>Azure Local <strong>requires</strong> a Key Vault for deployment. Azure Portal and HCI Resource Provider configure secrets during deployment.</p>
                        <div class="service-pe-requirements">
                            <div class="requirement-item warning">
                                <strong>‚ö†Ô∏è During Deployment:</strong>
                                <p>Keep <strong>public access enabled</strong> until initial deployment is complete.</p>
                            </div>
                            <div class="requirement-item success">
                                <strong>‚úÖ After Deployment:</strong>
                                <p>Restrict access to private networks only. Other customer Key Vaults for workloads can be fully private from the start.</p>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Storage Account -->
                <div class="service-pe-card">
                    <div class="service-pe-header storage">
                        <span class="service-icon">üíæ</span>
                        <div>
                            <h4>Azure Storage (Blob)</h4>
                            <code>blob.core.windows.net</code>
                        </div>
                    </div>
                    <div class="service-pe-content">
                        <p>Required for <strong>2-node deployments</strong> as cloud witness. Azure Portal and HCI RP configure the cloud witness during deployment.</p>
                        <div class="service-pe-requirements">
                            <div class="requirement-item warning">
                                <strong>‚ö†Ô∏è During Deployment:</strong>
                                <p>Keep <strong>public access enabled</strong> until initial deployment is complete.</p>
                            </div>
                            <div class="requirement-item success">
                                <strong>‚úÖ After Deployment:</strong>
                                <p>Restrict access to private networks only.</p>
                            </div>
                            <div class="requirement-item info">
                                <strong>üí° Optional:</strong>
                                <p>If your security team requires source IP validation on the private endpoint, add the storage endpoint to the proxy bypass list so traffic goes directly to your firewall instead of through Arc Gateway tunnel.</p>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Azure Container Registry -->
                <div class="service-pe-card">
                    <div class="service-pe-header acr">
                        <span class="service-icon">üì¶</span>
                        <div>
                            <h4>Azure Container Registry (ACR)</h4>
                            <code>azurecr.io</code>
                        </div>
                    </div>
                    <div class="service-pe-content">
                        <p>Crucial for <strong>AKS image pulls</strong>. Customers commonly pull container images for AKS workloads from private ACR endpoints.</p>
                        <div class="service-pe-requirements">
                            <div class="requirement-item danger">
                                <strong>üö´ No Wildcards:</strong>
                                <p><code>*.azurecr.io</code> is <strong>NOT supported</strong> in the bypass list. ARB VM uses specific ACR endpoints and the bypass list applies to both ARB and AKS.</p>
                            </div>
                            <div class="requirement-item success">
                                <strong>‚úÖ Required:</strong>
                                <p>Add <strong>specific ACR FQDNs</strong> to the proxy bypass list <strong>before deployment</strong>. This is particularly important when AKS clusters run on their own LNET and you want ACR traffic to go directly from AKS subnet to firewall.</p>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Azure Site Recovery -->
                <div class="service-pe-card">
                    <div class="service-pe-header asr">
                        <span class="service-icon">üîÑ</span>
                        <div>
                            <h4>Azure Site Recovery (ASR)</h4>
                            <code>privatelink.siterecovery.windowsazure.com</code>
                        </div>
                    </div>
                    <div class="service-pe-content">
                        <p>ASR private endpoint FQDNs are <strong>not allowed by Arc Gateway</strong>. Traffic must follow one of two outbound paths:</p>
                        <div class="asr-options">
                            <div class="asr-option">
                                <h5>Option 1: Via Enterprise Proxy</h5>
                                <p><strong>Do not</strong> add FQDNs to proxy bypass list. Traffic will be rejected by Arc proxy, retry via enterprise proxy.</p>
                                <div class="requirement-item warning">
                                    <strong>‚ö†Ô∏è Requirement:</strong> SSL inspection <strong>must be disabled</strong> on the enterprise proxy for ASR endpoints.
                                </div>
                            </div>
                            <div class="asr-option recommended">
                                <h5>Option 2: Via Proxy Bypass (Recommended)</h5>
                                <p>Add ASR FQDNs to proxy bypass list. Traffic goes directly to firewall, then to private endpoint via ExpressRoute/VPN.</p>
                                <div class="requirement-item success">
                                    <strong>‚úÖ Recommended:</strong> Simpler configuration, no SSL inspection concerns.
                                </div>
                            </div>
                        </div>
                        <div class="info-box" style="margin-top: 16px;">
                            <h4>üìñ Reference</h4>
                            <p>See <a href="https://learn.microsoft.com/en-us/azure/site-recovery/azure-to-azure-how-to-enable-replication-private-endpoints" target="_blank">Enable replication for private endpoints in Azure Site Recovery</a> for detailed configuration.</p>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Private Endpoints Routing Summary Table -->
            <div class="pe-routing-summary">
                <h3>Private Endpoints Routing by Scenario</h3>
                <table class="comparison-table">
                    <thead>
                        <tr>
                            <th>Scenario</th>
                            <th>PE Outbound Path</th>
                            <th>Arc Private Link</th>
                            <th>Key Requirements</th>
                        </tr>
                    </thead>
                    <tbody>
                        <tr>
                            <td><strong>1. No Proxy, No Arc GW</strong></td>
                            <td>Direct ‚Üí ExpressRoute/VPN</td>
                            <td>‚ùå Not Supported</td>
                            <td>Configure routing and DNS; no proxy bypass needed</td>
                        </tr>
                        <tr>
                            <td><strong>2. Proxy, No Arc GW</strong></td>
                            <td>Proxy bypassed ‚Üí ExpressRoute/VPN</td>
                            <td>‚ùå Not Supported</td>
                            <td>Add PE FQDNs to proxy bypass list</td>
                        </tr>
                        <tr>
                            <td><strong>3. No Proxy, Arc GW</strong></td>
                            <td>Cluster IP proxy bypassed ‚Üí ExpressRoute/VPN</td>
                            <td>‚ùå Not Supported</td>
                            <td>Add PE FQDNs to Environment Variables bypass after Arc registration</td>
                        </tr>
                        <tr>
                            <td><strong>4. Proxy, Arc GW</strong></td>
                            <td>Proxy bypassed ‚Üí ExpressRoute/VPN</td>
                            <td>‚ùå Not Supported</td>
                            <td>Add PE FQDNs to proxy bypass list during Arc registration</td>
                        </tr>
                    </tbody>
                </table>
            </div>
        </section>

        <!-- Reserved Subnets Section -->
        <section id="reserved-subnets" class="section">
            <h2>Reserved Subnets: ARB & AKS</h2>
            
            <p>The Arc Resource Bridge (ARB) VM reserves specific IP ranges for internal Kubernetes operations. <strong>Never use these ranges for your private endpoint networks</strong> ‚Äî traffic will fail to route correctly.</p>

            <div class="reserved-subnets-warning">
                <h3>‚ö†Ô∏è Critical: Avoid IP Overlaps</h3>
                <p>If your private endpoint network uses IPs within these reserved ranges, traffic will fail because ARB/AKS treat them as internal addresses.</p>
            </div>

            <div class="reserved-subnets-table">
                <h3>ARB Reserved IP Ranges</h3>
                <table class="comparison-table">
                    <thead>
                        <tr>
                            <th>Service Component</th>
                            <th>Designated IP Range</th>
                            <th>IP Address Range</th>
                        </tr>
                    </thead>
                    <tbody>
                        <tr>
                            <td><strong>Arc Resource Bridge Kubernetes Pods</strong></td>
                            <td><code>10.244.0.0/16</code></td>
                            <td>10.244.0.1 to 10.244.255.254</td>
                        </tr>
                        <tr>
                            <td><strong>Arc Resource Bridge Kubernetes Services</strong></td>
                            <td><code>10.96.0.0/12</code></td>
                            <td>10.96.0.1 to 10.111.255.254</td>
                        </tr>
                    </tbody>
                </table>
            </div>

            <div class="ip-conflict-example">
                <h3>IP Overlap Scenario Example</h3>
                <div class="conflict-comparison">
                    <div class="conflict-card fail">
                        <h4>‚ùå Internal Conflict (FAIL)</h4>
                        <div class="conflict-details">
                            <div class="ip-badge fail">Endpoint IP: <strong>10.244.1.4</strong></div>
                            <p>Inside reserved pod range (10.244.0.0/16)</p>
                            <p class="result">AKS treats this as <strong>internal traffic</strong>. Traffic never leaves the VNET ‚Äî routing fails.</p>
                        </div>
                    </div>
                    <div class="conflict-card success">
                        <h4>‚úÖ Correct Routing (SUCCESS)</h4>
                        <div class="conflict-details">
                            <div class="ip-badge success">Endpoint IP: <strong>10.245.0.5</strong></div>
                            <p>Outside reserved pod range</p>
                            <p class="result">AKS resolves as <strong>external traffic</strong>. Traffic routes correctly to Private Endpoint.</p>
                        </div>
                    </div>
                </div>
            </div>

            <div class="subnet-best-practices">
                <h3>Best Practices for Private Endpoint Networks</h3>
                <ul class="best-practices-list">
                    <li>
                        <span class="bp-icon">üîç</span>
                        <div>
                            <strong>Verify your Private Endpoint VNETs</strong>
                            <p>Before deploying, ensure your private endpoint networks do NOT overlap with <code>10.244.0.0/16</code> or <code>10.96.0.0/12</code></p>
                        </div>
                    </li>
                    <li>
                        <span class="bp-icon">üìã</span>
                        <div>
                            <strong>Use non-conflicting address spaces</strong>
                            <p>Recommended: Use address ranges like <code>10.0.0.0/16</code>, <code>10.1.0.0/16</code>, <code>172.16.0.0/16</code> for private endpoints</p>
                        </div>
                    </li>
                    <li>
                        <span class="bp-icon">üß™</span>
                        <div>
                            <strong>Test connectivity before production</strong>
                            <p>Validate private endpoint routing from ARB and AKS workloads in a test environment</p>
                        </div>
                    </li>
                </ul>
            </div>
        </section>

        <!-- Combined Traffic Flows Comparison Section -->
        <section id="traffic-flows-comparison" class="section">
            <h2>Traffic Flow Comparison: Public vs Private Path</h2>
            
            <p>Compare how traffic flows through each architecture side-by-side. Both paths handle the same traffic categories but route them differently.</p>

            <!-- Step 1: Bypass Traffic -->
            <div class="flow-comparison">
                <h3>Step 1: Bypass Traffic (Direct Communications)</h3>
                <p>Traffic that bypasses proxy entirely for internal communications and Private Link endpoints.</p>
                <div class="flow-comparison-grid">
                    <div class="flow-column public">
                        <h4>üåê Public Path</h4>
                        <div class="diagram-container">
                            <img src="images/public-path-step-1-bypass.svg" 
                                 alt="Public Path - Bypass Traffic" 
                                 class="diagram">
                        </div>
                        <div class="flow-details">
                            <ul>
                                <li>Internal intranet communications</li>
                                <li>Node-to-node communications</li>
                                <li>Private Link endpoints</li>
                            </ul>
                        </div>
                    </div>
                    <div class="flow-column private">
                        <h4>üîê Private Path</h4>
                        <div class="diagram-container private-path">
                            <img src="images/private-path-step-1-bypass.svg" 
                                 alt="Private Path - Bypass Traffic" 
                                 class="diagram">
                        </div>
                        <div class="flow-details">
                            <ul>
                                <li>Internal intranet communications</li>
                                <li>Node-to-node communications</li>
                                <li>Private Link endpoints (via ExpressRoute)</li>
                            </ul>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Step 2: HTTP Traffic -->
            <div class="flow-comparison">
                <h3>Step 2: HTTP Traffic via Proxy</h3>
                <p>HTTP traffic that cannot use Arc proxy is routed through enterprise proxy/firewall.</p>
                <div class="flow-comparison-grid">
                    <div class="flow-column public">
                        <h4>üåê Public Path</h4>
                        <div class="diagram-container">
                            <img src="images/public-path-step-2-http.svg" 
                                 alt="Public Path - HTTP Traffic" 
                                 class="diagram">
                        </div>
                        <div class="flow-details">
                            <ul>
                                <li>Node ‚Üí On-premises proxy/firewall</li>
                                <li>Proxy ‚Üí Public internet ‚Üí Azure</li>
                            </ul>
                        </div>
                    </div>
                    <div class="flow-column private">
                        <h4>üîê Private Path</h4>
                        <div class="diagram-container private-path">
                            <img src="images/private-path-step-2-http.svg" 
                                 alt="Private Path - HTTP Traffic" 
                                 class="diagram">
                        </div>
                        <div class="flow-details">
                            <ul>
                                <li>Node ‚Üí Customer Firewall</li>
                                <li>‚Üí ExpressRoute ‚Üí Azure Firewall Explicit Proxy</li>
                            </ul>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Step 3: HTTPS via Arc Proxy -->
            <div class="flow-comparison">
                <h3>Step 3: HTTPS Traffic via Arc Proxy</h3>
                <p>HTTPS traffic destined for Azure endpoints is routed through the Arc proxy to Arc Gateway.</p>
                <div class="flow-comparison-grid">
                    <div class="flow-column public">
                        <h4>üåê Public Path</h4>
                        <div class="diagram-container">
                            <img src="images/public-path-step-3-https.svg" 
                                 alt="Public Path - HTTPS via Arc Proxy" 
                                 class="diagram">
                        </div>
                        <div class="flow-details">
                            <ul>
                                <li>Node ‚Üí Arc Proxy ‚Üí On-prem Firewall</li>
                                <li>‚Üí Public Internet ‚Üí Arc Gateway ‚Üí Azure</li>
                            </ul>
                        </div>
                    </div>
                    <div class="flow-column private">
                        <h4>üîê Private Path</h4>
                        <div class="diagram-container private-path">
                            <img src="images/private-path-step-3-https.svg" 
                                 alt="Private Path - HTTPS via Arc Proxy" 
                                 class="diagram">
                        </div>
                        <div class="flow-details">
                            <ul>
                                <li>Node ‚Üí Arc Proxy ‚Üí Customer Firewall</li>
                                <li>‚Üí ExpressRoute ‚Üí Azure Firewall ‚Üí Arc Gateway ‚Üí Azure</li>
                            </ul>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Step 4: ARB VM -->
            <div class="flow-comparison">
                <h3>Step 4: Azure Resource Bridge (ARB) VM via Cluster IP</h3>
                <p>ARB VM uses Cluster IP as its proxy endpoint to route traffic through Arc Gateway.</p>
                <div class="flow-comparison-grid">
                    <div class="flow-column public">
                        <h4>üåê Public Path</h4>
                        <div class="diagram-container">
                            <img src="images/public-path-step-4-arb.svg" 
                                 alt="Public Path - ARB VM" 
                                 class="diagram">
                        </div>
                        <div class="flow-details">
                            <ul>
                                <li>ARB VM ‚Üí Cluster IP:40343</li>
                                <li>‚Üí Arc Gateway ‚Üí Public Internet ‚Üí Azure</li>
                            </ul>
                        </div>
                    </div>
                    <div class="flow-column private">
                        <h4>üîê Private Path</h4>
                        <div class="diagram-container private-path">
                            <img src="images/private-path-step-4-arb.svg" 
                                 alt="Private Path - ARB VM" 
                                 class="diagram">
                        </div>
                        <div class="flow-details">
                            <ul>
                                <li>ARB VM ‚Üí Cluster IP:40343</li>
                                <li>‚Üí ExpressRoute ‚Üí Arc Gateway ‚Üí Azure</li>
                            </ul>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Step 5: AKS Clusters -->
            <div class="flow-comparison">
                <h3>Step 5: AKS Clusters via Cluster IP Proxy</h3>
                <p>AKS Control Plane VMs, Worker VMs, and Pods route traffic through Cluster IP proxy.</p>
                <div class="flow-comparison-grid">
                    <div class="flow-column public">
                        <h4>üåê Public Path</h4>
                        <div class="diagram-container">
                            <img src="images/public-path-step-5-aks.svg" 
                                 alt="Public Path - AKS Clusters" 
                                 class="diagram">
                        </div>
                        <div class="flow-details">
                            <ul>
                                <li>AKS VMs/Pods ‚Üí Cluster IP:40343</li>
                                <li>‚Üí Arc Gateway ‚Üí Public Internet ‚Üí Azure</li>
                            </ul>
                        </div>
                    </div>
                    <div class="flow-column private">
                        <h4>üîê Private Path</h4>
                        <div class="diagram-container private-path">
                            <img src="images/private-path-step-5-aks.svg" 
                                 alt="Private Path - AKS Clusters" 
                                 class="diagram">
                        </div>
                        <div class="flow-details">
                            <ul>
                                <li>AKS VMs/Pods ‚Üí Cluster IP:40343</li>
                                <li>‚Üí ExpressRoute ‚Üí Arc Gateway ‚Üí Azure</li>
                            </ul>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Step 6: VMs -->
            <div class="flow-comparison">
                <h3>Step 6: Azure Local VMs via Dedicated Arc Proxy</h3>
                <p>Each Azure Local VM uses its own dedicated Arc proxy for HTTPS traffic.</p>
                <div class="flow-comparison-grid">
                    <div class="flow-column public">
                        <h4>üåê Public Path</h4>
                        <div class="diagram-container">
                            <img src="images/public-path-step-6-vns.svg" 
                                 alt="Public Path - VMs" 
                                 class="diagram">
                        </div>
                        <div class="flow-details">
                            <ul>
                                <li>VM ‚Üí Dedicated Arc Proxy</li>
                                <li>‚Üí Arc Gateway ‚Üí Public Internet ‚Üí Azure</li>
                            </ul>
                        </div>
                    </div>
                    <div class="flow-column private">
                        <h4>üîê Private Path</h4>
                        <div class="diagram-container private-path">
                            <img src="images/private-path-step-6-vms.svg" 
                                 alt="Private Path - VMs" 
                                 class="diagram">
                        </div>
                        <div class="flow-details">
                            <ul>
                                <li>VM ‚Üí Dedicated Arc Proxy</li>
                                <li>‚Üí ExpressRoute ‚Üí Arc Gateway ‚Üí Azure</li>
                            </ul>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Key Differences Summary -->
            <div class="complete-summary">
                <h3>Key Routing Differences</h3>
                <p style="margin-bottom: 1.5rem; color: var(--text-secondary);">Comparing the most complete configurations from each path: <strong>Public Path Option 4</strong> (Proxy + Arc Gateway) vs <strong>Private Path</strong> (Azure FW Explicit Proxy + Arc Gateway)</p>
                <div class="flow-comparison-grid">
                    <div class="flow-column public">
                        <h4>üåê Public Path Routes</h4>
                        <p style="font-size: 0.85rem; color: var(--text-muted); margin-bottom: 1rem;">Option 4: On-prem Proxy + Arc Gateway</p>
                        <div class="routing-cards">
                            <div class="component-card">
                                <h4>Bypass Traffic</h4>
                                <p>Direct to internal services</p>
                            </div>
                            <div class="component-card">
                                <h4>HTTP Traffic</h4>
                                <p>On-prem proxy ‚Üí Corporate FW ‚Üí Public internet</p>
                            </div>
                            <div class="component-card">
                                <h4>HTTPS Traffic</h4>
                                <p>Arc Proxy ‚Üí Corporate FW ‚Üí Public internet ‚Üí Arc Gateway</p>
                            </div>
                            <div class="component-card">
                                <h4>ARB/AKS Traffic</h4>
                                <p>Cluster IP ‚Üí Arc Proxy ‚Üí Corporate FW ‚Üí Public internet ‚Üí Arc Gateway</p>
                            </div>
                        </div>
                    </div>
                    <div class="flow-column private">
                        <h4>üîê Private Path Routes</h4>
                        <p style="font-size: 0.85rem; color: var(--text-muted); margin-bottom: 1rem;">Azure FW Explicit Proxy + Arc Gateway</p>
                        <div class="routing-cards">
                            <div class="component-card">
                                <h4>Bypass Traffic</h4>
                                <p>Direct to internal services</p>
                            </div>
                            <div class="component-card">
                                <h4>HTTP Traffic</h4>
                                <p>On-prem host ‚Üí Corporate FW ‚Üí ExpressRoute ‚Üí Azure FW Explicit Proxy</p>
                            </div>
                            <div class="component-card">
                                <h4>HTTPS Traffic</h4>
                                <p>Arc Proxy ‚Üí ExpressRoute ‚Üí Azure FW ‚Üí Arc Gateway</p>
                            </div>
                            <div class="component-card">
                                <h4>ARB/AKS Traffic</h4>
                                <p>Cluster IP ‚Üí Arc Proxy ‚Üí ExpressRoute ‚Üí Arc Gateway</p>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </section>

        <!-- Traffic Categories Section -->
        <section id="traffic-categories" class="section">
            <h2>Traffic Categories</h2>
            
            <p>Network traffic is categorized based on how it should be routed. These categories apply to <strong>both Public and Private Path</strong> architectures.</p>

            <div class="traffic-categories">
                <div class="traffic-card blue">
                    <div class="traffic-header">
                        <span class="traffic-icon">üü¶</span>
                        <h4>Bypass Traffic</h4>
                    </div>
                    <div class="traffic-body">
                        <p>HTTP/HTTPS that must bypass proxy entirely.</p>
                        <ul>
                            <li>Internal intranet communications</li>
                            <li>Node-to-node communications</li>
                            <li>Internal management systems</li>
                            <li>Private Link endpoints (Key Vault, Storage)</li>
                        </ul>
                    </div>
                </div>

                <div class="traffic-card yellow">
                    <div class="traffic-header">
                        <span class="traffic-icon">üü®</span>
                        <h4>HTTP Traffic</h4>
                    </div>
                    <div class="traffic-body">
                        <p>HTTP traffic incompatible with Arc proxy.</p>
                        <ul>
                            <li>Routes through enterprise proxy</li>
                            <li>Public Path: On-premises proxy</li>
                            <li>Private Path: Azure Firewall Explicit Proxy</li>
                        </ul>
                    </div>
                </div>

                <div class="traffic-card green">
                    <div class="traffic-header">
                        <span class="traffic-icon">üü©</span>
                        <h4>HTTPS via Arc Proxy</h4>
                    </div>
                    <div class="traffic-body">
                        <p>HTTPS always routed through Arc proxy.</p>
                        <ul>
                            <li>Microsoft-managed endpoints</li>
                            <li>Secure HTTPS tunnel to Arc Gateway</li>
                            <li>Built-in security and management</li>
                        </ul>
                    </div>
                </div>

                <div class="traffic-card red">
                    <div class="traffic-header">
                        <span class="traffic-icon">üü•</span>
                        <h4>Third-party HTTPS</h4>
                    </div>
                    <div class="traffic-body">
                        <p>HTTPS not permitted through Arc Gateway.</p>
                        <ul>
                            <li>OEM endpoints</li>
                            <li>Hardware vendor updates</li>
                            <li>Third-party agents</li>
                            <li>Redirected to firewall/proxy</li>
                        </ul>
                    </div>
                </div>

                <div class="traffic-card purple">
                    <div class="traffic-header">
                        <span class="traffic-icon">üìò</span>
                        <h4>ARB/AKS via Cluster IP</h4>
                    </div>
                    <div class="traffic-body">
                        <p>Arc Resource Bridge and AKS traffic.</p>
                        <ul>
                            <li>Uses Cluster IP:40343 as proxy</li>
                            <li>Routes through Arc proxy running on the host</li>
                            <li>Control plane and pods</li>
                        </ul>
                    </div>
                </div>
            </div>
        </section>

        <!-- AKS Subnet Requirements Section -->
        <section id="aks-subnet" class="section">
            <h2>AKS Clusters on Separated Subnet</h2>
            
            <p>When AKS clusters run on a separated subnet from the Azure Local infrastructure subnet, additional firewall rules are required.</p>

            <div class="flow-comparison-grid">
                <div class="flow-column public">
                    <h4>üåê Public Path</h4>
                    <div class="diagram-container">
                        <img src="images/public-path-step-5bis-akssubnet.svg" 
                             alt="AKS Clusters on Separated Subnet - Public Path" 
                             class="diagram">
                        <div class="diagram-fallback" style="display:none;">
                            <p>Diagram showing AKS subnet firewall requirements (Public Path).</p>
                        </div>
                    </div>
                </div>
                <div class="flow-column private">
                    <h4>üîê Private Path</h4>
                    <div class="diagram-container private-path">
                        <img src="images/private-path-step-5bis-akssubnet.svg" 
                             alt="AKS Clusters on Separated Subnet - Private Path" 
                             class="diagram">
                    </div>
                </div>
            </div>

            <h3>Firewall Requirements</h3>
            
            <h4>Traffic between AKS subnet and Azure Local Infrastructure subnet</h4>
            <table class="requirements-table">
                <thead>
                    <tr>
                        <th>Port</th>
                        <th>Protocol</th>
                        <th>Direction</th>
                        <th>Purpose</th>
                    </tr>
                </thead>
                <tbody>
                    <tr>
                        <td><strong>40343</strong></td>
                        <td>HTTPS/HTTP Connect</td>
                        <td>AKS ‚Üí Cluster IP</td>
                        <td>Arc Gateway proxy (L4 and L7)</td>
                    </tr>
                    <tr>
                        <td><strong>55000</strong></td>
                        <td>TCP</td>
                        <td>AKS ‚Üí Cluster IP</td>
                        <td>Communication</td>
                    </tr>
                    <tr>
                        <td><strong>65000</strong></td>
                        <td>TCP</td>
                        <td>AKS ‚Üí Cluster IP</td>
                        <td>Communication</td>
                    </tr>
                    <tr>
                        <td><strong>22</strong></td>
                        <td>TCP</td>
                        <td>Bidirectional</td>
                        <td>SSH</td>
                    </tr>
                    <tr>
                        <td><strong>6443</strong></td>
                        <td>TCP</td>
                        <td>Bidirectional</td>
                        <td>Kubernetes API</td>
                    </tr>
                </tbody>
            </table>

            <div class="info-box">
                <h4>üìå Additional FQDN Endpoints</h4>
                <p>Although Arc Gateway reduces the HTTPS endpoints required, you must still allow access to endpoints not supported by Arc Gateway. Refer to the <a href="https://learn.microsoft.com/en-us/azure/aks/aksarc/arc-gateway-aks-arc#confirm-access-to-required-urls" target="_blank">AKS subnet required FQDN endpoints</a> documentation.</p>
            </div>
        </section>

        <!-- Configuration Section -->
        <section id="configuration" class="section">
            <h2>Configuration</h2>

            <h3>Proxy Bypass Requirements</h3>
            <p>When defining your proxy bypass string for Arc initialization or the Companion App, include:</p>

            <div class="config-section">
                <h4>‚úÖ Required Bypass Entries</h4>
                <ul class="config-list">
                    <li>IP address of each Azure Local machine</li>
                    <li>Cluster IP address</li>
                    <li>Infrastructure network IPs (ARB, AKS, future services)</li>
                    <li>Or bypass the entire infrastructure subnet</li>
                    <li>NetBIOS name of each machine</li>
                    <li>NetBIOS name of the Cluster</li>
                    <li>Domain name with asterisk wildcard (e.g., <code>*.contoso.com</code>)</li>
                    <li>Subnet wildcards (e.g., <code>192.168.1.*</code>)</li>
                    <li>Private Link endpoints (Key Vault, Storage, etc.)</li>
                </ul>
            </div>

            <div class="config-section warning">
                <h4>‚ùå Not Supported</h4>
                <ul class="config-list">
                    <li>CIDR notation for subnets</li>
                    <li><code>&lt;local&gt;</code> strings in bypass list</li>
                    <li><code>.local</code> domain for proxy server name</li>
                </ul>
            </div>

            <div class="code-block">
                <h4>Example Bypass String</h4>
                <pre><code># Bypass list format (comma-separated)
192.168.1.10,192.168.1.11,192.168.1.12,   # Node IPs
192.168.1.100,                              # Cluster IP
192.168.1.*,                                # Infrastructure subnet
NODE1,NODE2,NODE3,                          # NetBIOS names
CLUSTER01,                                  # Cluster NetBIOS
*.contoso.com,                              # Domain wildcard
keyvault.vault.azure.net,                   # Private Link endpoints
storageaccount.blob.core.windows.net</code></pre>
            </div>

            <h3>Registration Script Examples</h3>
            <p>Use these PowerShell scripts to register Azure Local nodes with Azure Arc. Run on each node as local administrator.</p>

            <!-- Option 1: No Proxy, No Arc Gateway -->
            <div class="config-section">
                <h4>üìú Option 1: No Proxy, No Arc Gateway</h4>
                <p>Simplest configuration - direct connection to Azure through firewall only.</p>
                <a href="https://learn.microsoft.com/en-us/azure/azure-local/deploy/deployment-without-azure-arc-gateway?view=azloc-2601&tabs=script&pivots=register-without-proxy" target="_blank" class="doc-link">üìñ Full Documentation ‚Üó</a>
            </div>
            <div class="code-block">
                <h4>Set Parameters</h4>
                <pre><code># Define tenant and subscription
$Tenant = "YourTenantID"
$Subscription = "YourSubscriptionID"
$RG = "YourResourceGroupName"
$Region = "eastus"  # Do not use spaces or capital letters</code></pre>
            </div>
            <div class="code-block">
                <h4>Run Registration Script</h4>
                <pre><code># Invoke registration (no proxy, no Arc Gateway)
Invoke-AzStackHciArcInitialization `
    -TenantId $Tenant `
    -SubscriptionID $Subscription `
    -ResourceGroup $RG `
    -Region $Region `
    -Cloud "AzureCloud"</code></pre>
            </div>

            <!-- Option 2: Proxy, No Arc Gateway -->
            <div class="config-section">
                <h4>üìú Option 2: Proxy, No Arc Gateway</h4>
                <p>Traffic routes through enterprise proxy. Proxy handles URL filtering and logging.</p>
                <a href="https://learn.microsoft.com/en-us/azure/azure-local/deploy/deployment-without-azure-arc-gateway?view=azloc-2601&tabs=script&pivots=register-proxy" target="_blank" class="doc-link">üìñ Full Documentation ‚Üó</a>
            </div>
            <div class="code-block">
                <h4>Set Parameters</h4>
                <pre><code># Define tenant and subscription
$Tenant = "YourTenantID"
$Subscription = "YourSubscriptionID"
$RG = "YourResourceGroupName"
$Region = "eastus"  # Do not use spaces or capital letters

# Define proxy server address
$ProxyServer = "http://proxyaddress:port"

# Define bypass list (comma-separated)
# Use "localhost" instead of &lt;local&gt;
# Use * for subnets: 192.168.1.* for /24, 192.168.*.* for /16
# Append * for domains: *.contoso.com
# Include: Node IPs, Cluster IP, Infrastructure IPs, NetBIOS names, Private Endpoints
$ProxyBypassList = "localhost,127.0.0.1,*.contoso.com,machine1,machine2,machine3,192.168.*.*,AzureLocal-1,mykeyvault.vault.azure.net,mystorageaccount.blob.core.windows.net,mystorageaccount.file.core.windows.net"</code></pre>
            </div>
            <div class="code-block">
                <h4>Run Registration Script</h4>
                <pre><code># Invoke registration (with proxy, no Arc Gateway)
Invoke-AzStackHciArcInitialization `
    -TenantId $Tenant `
    -SubscriptionID $Subscription `
    -ResourceGroup $RG `
    -Region $Region `
    -Cloud "AzureCloud" `
    -Proxy $ProxyServer `
    -ProxyBypass $ProxyBypassList</code></pre>
            </div>

            <!-- Option 3: No Proxy, Arc Gateway -->
            <div class="config-section">
                <h4>üìú Option 3: No Proxy, Arc Gateway</h4>
                <p>Arc Gateway handles Azure connectivity. Reduces firewall rules to fewer than 30 endpoints.</p>
                <a href="https://learn.microsoft.com/en-us/azure/azure-local/deploy/deployment-with-azure-arc-gateway?view=azloc-2601&tabs=script&pivots=register-without-proxy" target="_blank" class="doc-link">üìñ Full Documentation ‚Üó</a>
            </div>
            <div class="code-block">
                <h4>Step 1: Get Arc Gateway ID from Azure Portal</h4>
                <pre><code># In Azure Portal:
# 1. Go to your Arc gateway resource
# 2. On the Overview page, copy the Resource ID
# Format: /subscriptions/{sub}/resourceGroups/{rg}/providers/Microsoft.HybridCompute/gateways/{name}</code></pre>
            </div>
            <div class="code-block">
                <h4>Step 2: Set Parameters</h4>
                <pre><code># Define tenant and subscription
$Tenant = "YourTenantID"
$Subscription = "YourSubscriptionID"
$RG = "YourResourceGroupName"
$Region = "eastus"  # Do not use spaces or capital letters

# Define Arc Gateway Resource ID from Azure Portal
$ArcgwId = "/subscriptions/yourSubscriptionId/resourceGroups/yourResourceGroupName/providers/Microsoft.HybridCompute/gateways/yourArcGatewayName"</code></pre>
            </div>
            <div class="code-block">
                <h4>Step 3: Run Registration Script</h4>
                <pre><code># Invoke registration (no proxy, with Arc Gateway)
Invoke-AzStackHciArcInitialization `
    -TenantID $Tenant `
    -SubscriptionID $Subscription `
    -ResourceGroup $RG `
    -Region $Region `
    -Cloud "AzureCloud" `
    -ArcGatewayID $ArcgwId</code></pre>
            </div>

            <!-- Option 4: Proxy with Arc Gateway -->
            <div class="config-section">
                <h4>üìú Option 4: Proxy + Arc Gateway</h4>
                <p>Best of both worlds: Arc Gateway for HTTPS to Azure, enterprise proxy for HTTP and third-party traffic.</p>
                <a href="https://learn.microsoft.com/en-us/azure/azure-local/deploy/deployment-with-azure-arc-gateway?view=azloc-2601&tabs=script&pivots=register-proxy" target="_blank" class="doc-link">üìñ Full Documentation ‚Üó</a>
            </div>
            <div class="code-block">
                <h4>Step 1: Get Arc Gateway ID from Azure Portal</h4>
                <pre><code># In Azure Portal:
# 1. Go to your Arc gateway resource
# 2. On the Overview page, copy the Resource ID
# Format: /subscriptions/{sub}/resourceGroups/{rg}/providers/Microsoft.HybridCompute/gateways/{name}</code></pre>
            </div>
            <div class="code-block">
                <h4>Step 2: Set Parameters</h4>
                <pre><code># Define tenant and subscription
$Tenant = "YourTenantID"
$Subscription = "YourSubscriptionID"
$RG = "YourResourceGroupName"
$Region = "eastus"  # Do not use spaces or capital letters

# Define proxy server address
$ProxyServer = "http://proxyaddress:port"

# Define bypass list (comma-separated)
# Use "localhost" instead of &lt;local&gt;
# Use * for subnets: 192.168.1.* for /24, 192.168.*.* for /16
# Append * for domains: *.contoso.com
# Include: Node IPs, Cluster IP, Infrastructure IPs, NetBIOS names, Private Endpoints
$ProxyBypassList = "localhost,127.0.0.1,*.contoso.com,machine1,machine2,machine3,192.168.*.*,AzureLocal-1,mykeyvault.vault.azure.net,mystorageaccount.blob.core.windows.net,mystorageaccount.file.core.windows.net"

# Define Arc Gateway Resource ID from Azure Portal
$ArcgwId = "/subscriptions/yourSubscriptionId/resourceGroups/yourResourceGroupName/providers/Microsoft.HybridCompute/gateways/yourArcGatewayName"</code></pre>
            </div>
            <div class="code-block">
                <h4>Step 3: Run Registration Script</h4>
                <pre><code># Invoke registration (with proxy and Arc Gateway)
Invoke-AzStackHciArcInitialization `
    -TenantID $Tenant `
    -SubscriptionID $Subscription `
    -ResourceGroup $RG `
    -Region $Region `
    -Cloud "AzureCloud" `
    -Proxy $ProxyServer `
    -ArcGatewayID $ArcgwId `
    -ProxyBypass $ProxyBypassList</code></pre>
            </div>

            <!-- Verification -->
            <div class="config-section">
                <h4>‚úÖ Verify Registration</h4>
                <p>After registration completes, verify the setup:</p>
            </div>
            <div class="code-block">
                <h4>Check Arc Agent Status</h4>
                <pre><code># Check Arc agent configuration
& "C:\Program Files\AzureConnectedMachineAgent\azcmagent.exe" show

# Expected values:
# - Agent Status: Connected
# - Using HTTPS Proxy: http://localhost:40343 (when Arc Gateway enabled)
# - Upstream Proxy: Your enterprise proxy (if configured)
# - Azure Arc Proxy: Running (when Arc Gateway enabled)

# Verify connectivity
& "C:\Program Files\AzureConnectedMachineAgent\azcmagent.exe" check

# All URLs should show Reachable: true
# Connection.type should be "gateway" when Arc Gateway is enabled</code></pre>
            </div>

            <div class="info-box">
                <h4>üí° Important Notes</h4>
                <ul>
                    <li>Run these scripts as <strong>local administrator</strong> on each Azure Local node</li>
                    <li>During registration, you'll need to authenticate with your Azure account using a device code</li>
                    <li>If using an OEM pre-installed image, an automatic update may trigger (40-45 minutes) - rerun the script after reboot</li>
                    <li>Arc Gateway log location: <code>C:\ProgramData\AzureConnectedMachineAgent\Log\arcproxy.log</code></li>
                </ul>
            </div>
        </section>

        <!-- Footer -->
        <footer class="footer">
            <p>Azure Local Connectivity Guide | Based on Microsoft Documentation</p>
            <p>Source: <a href="https://github.com/Azure/AzureLocal-Supportability/blob/main/TSG/Networking/Arc-Gateway-Outbound-Connectivity/DeepDive-ArcGateway-Outbound-Traffic.md" target="_blank">Azure Local Supportability GitHub</a></p>
        </footer>
    </main>

    <script src="script.js"></script>
    <!-- Analytics -->
    <script src="../../js/analytics.js"></script>
</body>
</html>
