<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="X-Content-Type-Options" content="nosniff">
    <meta http-equiv="X-Frame-Options" content="SAMEORIGIN">
    <meta http-equiv="X-XSS-Protection" content="1; mode=block">
    <meta name="referrer" content="no-referrer">
    <meta name="description" content="ODIN Sizer - Azure Local Instance Sizing Tool">
    <meta name="keywords" content="Azure Local, Azure Stack HCI, Cluster Sizing, Capacity Planning, Odin">
    <title>ODIN Sizer - Azure Local Sizing Tool</title>
    <!-- Firebase SDK -->
    <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-database-compat.js"></script>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Segoe+UI:wght@300;400;600;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="sizer.css">
</head>
<body>
    <!-- Tab Navigation -->
    <nav class="odin-tab-nav">
        <div class="odin-tab-container">
            <a href="../index.html" class="odin-tab-logo">
                <img src="../odin-logo.png" alt="Odin">
                <span>ODIN</span>
            </a>
            <a href="../index.html" class="odin-tab-btn" data-tab="designer">
                <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                    <rect x="3" y="3" width="18" height="18" rx="2"/>
                    <path d="M3 9h18M9 21V9"/>
                </svg>
                Designer
            </a>
            <a href="../docs/outbound-connectivity/index.html" class="odin-tab-btn" data-tab="knowledge">
                <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                    <path d="M4 19.5A2.5 2.5 0 0 1 6.5 17H20"/>
                    <path d="M6.5 2H20v20H6.5A2.5 2.5 0 0 1 4 19.5v-15A2.5 2.5 0 0 1 6.5 2z"/>
                </svg>
                Knowledge
            </a>
            <a href="#" class="odin-tab-btn active" data-tab="sizer">
                <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                    <path d="M3 3v18h18"/>
                    <path d="M18 17V9"/>
                    <path d="M13 17V5"/>
                    <path d="M8 17v-3"/>
                </svg>
                Sizer
                <span class="odin-tab-badge">Preview</span>
            </a>
            <button onclick="toggleTheme()" id="theme-toggle" class="nav-theme-toggle" title="Toggle light/dark theme">ðŸŒ™</button>
        </div>
    </nav>

    <main class="container">
        <!-- Header -->
        <header class="sizer-header">
            <div class="header-content">
                <h1>ODIN Sizer</h1>
                <p class="subtitle">Azure Local Instance Sizing Tool</p>
            </div>
            <div class="header-actions">
                <button class="btn btn-secondary" onclick="resetScenario()">
                    <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <path d="M3 12a9 9 0 1 0 9-9 9.75 9.75 0 0 0-6.74 2.74L3 8"/>
                        <path d="M3 3v5h5"/>
                    </svg>
                    Reset
                </button>
            </div>
        </header>

        <div class="sizer-layout">
            <!-- Left Panel: Workload Configuration -->
            <div class="config-panel">
                <!-- Cluster Configuration - FIRST -->
                <div class="panel-section cluster-config">
                    <h2>
                        <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                            <circle cx="12" cy="12" r="3"/>
                            <path d="M12 1v6M12 17v6M4.22 4.22l4.24 4.24M15.54 15.54l4.24 4.24M1 12h6M17 12h6M4.22 19.78l4.24-4.24M15.54 8.46l4.24-4.24"/>
                        </svg>
                        Cluster Configuration
                    </h2>
                    <p class="section-desc">Configure your cluster topology and storage settings first.</p>
                    
                    <div class="config-row">
                        <label for="node-count">Number of Nodes</label>
                        <select id="node-count" onchange="onNodeCountChange()">
                            <option value="1">1 Node (Single)</option>
                            <option value="2">2 Nodes</option>
                            <option value="3" selected>3 Nodes</option>
                            <option value="4">4 Nodes</option>
                            <option value="5">5 Nodes</option>
                            <option value="6">6 Nodes</option>
                            <option value="7">7 Nodes</option>
                            <option value="8">8 Nodes</option>
                            <option value="12">12 Nodes</option>
                            <option value="16">16 Nodes</option>
                        </select>
                    </div>
                    <div class="config-row">
                        <label for="rack-aware">Cluster Type</label>
                        <select id="rack-aware" onchange="onClusterTypeChange()">
                            <option value="false" selected>Standard Cluster</option>
                            <option value="true">Rack-Aware Cluster</option>
                        </select>
                    </div>
                    <div class="config-row">
                        <label for="resiliency">Storage Resiliency</label>
                        <select id="resiliency" onchange="onResiliencyChange()">
                            <option value="2way">Two-way Mirror (min 2 nodes)</option>
                            <option value="3way" selected>Three-way Mirror (min 3 nodes)</option>
                            <option value="parity">Dual Parity (min 4 nodes)</option>
                        </select>
                    </div>
                    <div class="config-info" id="cluster-info">
                        <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                            <circle cx="12" cy="12" r="10"/>
                            <path d="M12 16v-4M12 8h.01"/>
                        </svg>
                        <span id="cluster-info-text">Tip: Three-way Mirror requires minimum 3 fault domains (nodes). For multi-node clusters, N+1 capacity must be reserved when applying updates (ability to drain a node).</span>
                    </div>
                </div>

                <div class="panel-section">
                    <h2>
                        <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                            <path d="M21 16V8a2 2 0 0 0-1-1.73l-7-4a2 2 0 0 0-2 0l-7 4A2 2 0 0 0 3 8v8a2 2 0 0 0 1 1.73l7 4a2 2 0 0 0 2 0l7-4A2 2 0 0 0 21 16z"/>
                        </svg>
                        Workload Scenario
                    </h2>
                    <p class="section-desc">Add workloads to calculate your Azure Local cluster requirements.</p>
                </div>

                <!-- Workload Type Selector -->
                <div class="workload-types">
                    <button class="workload-type-btn" onclick="showAddWorkloadModal('vm')">
                        <div class="workload-icon vm">
                            <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                <rect x="2" y="3" width="20" height="14" rx="2"/>
                                <path d="M8 21h8M12 17v4"/>
                            </svg>
                        </div>
                        <span>Azure Local VMs</span>
                    </button>
                    <button class="workload-type-btn" onclick="showAddWorkloadModal('aks')">
                        <div class="workload-icon aks">
                            <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                <path d="M12 2L2 7l10 5 10-5-10-5z"/>
                                <path d="M2 17l10 5 10-5"/>
                                <path d="M2 12l10 5 10-5"/>
                            </svg>
                        </div>
                        <span>AKS Arc Clusters</span>
                    </button>
                    <button class="workload-type-btn" onclick="showAddWorkloadModal('avd')">
                        <div class="workload-icon avd">
                            <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                <rect x="2" y="3" width="20" height="14" rx="2"/>
                                <path d="M6 21h12"/>
                                <path d="M9 17v4M15 17v4"/>
                            </svg>
                        </div>
                        <span>Azure Virtual Desktop</span>
                    </button>
                </div>

                <!-- Workloads List -->
                <div class="workloads-list" id="workloads-list">
                    <div class="empty-state" id="empty-state">
                        <svg width="48" height="48" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5">
                            <path d="M21 16V8a2 2 0 0 0-1-1.73l-7-4a2 2 0 0 0-2 0l-7 4A2 2 0 0 0 3 8v8a2 2 0 0 0 1 1.73l7 4a2 2 0 0 0 2 0l7-4A2 2 0 0 0 21 16z"/>
                            <path d="M12 22V12M3.27 6.96L12 12l8.73-5.04"/>
                        </svg>
                        <p>No workloads added yet</p>
                        <span>Click a workload type above to get started</span>
                    </div>
                </div>
            </div>

            <!-- Right Panel: Results -->
            <div class="results-panel">
                <div class="panel-section">
                    <h2>
                        <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                            <path d="M3 3v18h18"/>
                            <path d="M18 17V9"/>
                            <path d="M13 17V5"/>
                            <path d="M8 17v-3"/>
                        </svg>
                        Requirements Summary
                    </h2>
                </div>

                <!-- Total Requirements -->
                <div class="requirements-grid">
                    <div class="requirement-card">
                        <div class="req-icon cpu">
                            <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                <rect x="4" y="4" width="16" height="16" rx="2"/>
                                <rect x="9" y="9" width="6" height="6"/>
                                <path d="M9 1v3M15 1v3M9 20v3M15 20v3M20 9h3M20 14h3M1 9h3M1 14h3"/>
                            </svg>
                        </div>
                        <div class="req-content">
                            <span class="req-label">Total vCPUs</span>
                            <span class="req-value" id="total-vcpus">0</span>
                        </div>
                    </div>
                    <div class="requirement-card">
                        <div class="req-icon memory">
                            <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                <path d="M6 19v-3M10 19v-3M14 19v-3M18 19v-3M6 8V5M10 8V5M14 8V5M18 8V5"/>
                                <rect x="3" y="8" width="18" height="8" rx="1"/>
                            </svg>
                        </div>
                        <div class="req-content">
                            <span class="req-label">Total Memory</span>
                            <span class="req-value" id="total-memory">0 GB</span>
                        </div>
                    </div>
                    <div class="requirement-card">
                        <div class="req-icon storage">
                            <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                <ellipse cx="12" cy="5" rx="9" ry="3"/>
                                <path d="M21 12c0 1.66-4 3-9 3s-9-1.34-9-3"/>
                                <path d="M3 5v14c0 1.66 4 3 9 3s9-1.34 9-3V5"/>
                            </svg>
                        </div>
                        <div class="req-content">
                            <span class="req-label">Total Storage</span>
                            <span class="req-value" id="total-storage">0 TB</span>
                        </div>
                    </div>
                    <div class="requirement-card">
                        <div class="req-icon workloads">
                            <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                <path d="M21 16V8a2 2 0 0 0-1-1.73l-7-4a2 2 0 0 0-2 0l-7 4A2 2 0 0 0 3 8v8a2 2 0 0 0 1 1.73l7 4a2 2 0 0 0 2 0l7-4A2 2 0 0 0 21 16z"/>
                            </svg>
                        </div>
                        <div class="req-content">
                            <span class="req-label">Total Workloads</span>
                            <span class="req-value" id="total-workloads">0</span>
                        </div>
                    </div>
                </div>

                <!-- Per-Node Requirements -->
                <div class="per-node-section">
                    <h3>Per-Node Requirements (with N+1)</h3>
                    <div class="per-node-grid">
                        <div class="per-node-item">
                            <span class="label">Physical Cores</span>
                            <span class="value" id="per-node-cores">0</span>
                        </div>
                        <div class="per-node-item">
                            <span class="label">Memory</span>
                            <span class="value" id="per-node-memory">0 GB</span>
                        </div>
                        <div class="per-node-item">
                            <span class="label">Raw Storage</span>
                            <span class="value" id="per-node-storage">0 TB</span>
                        </div>
                        <div class="per-node-item">
                            <span class="label">Usable Storage</span>
                            <span class="value" id="per-node-usable">0 TB</span>
                        </div>
                    </div>
                </div>

                <!-- Capacity Breakdown -->
                <div class="capacity-breakdown">
                    <h3>Capacity Breakdown</h3>
                    <div class="breakdown-bars">
                        <div class="breakdown-item">
                            <div class="breakdown-header">
                                <span>Compute (vCPUs)</span>
                                <span id="compute-percent">0%</span>
                            </div>
                            <div class="breakdown-bar">
                                <div class="breakdown-fill compute" id="compute-fill" style="width: 0%"></div>
                            </div>
                            <div class="breakdown-legend">
                                <span id="compute-used">0</span> / <span id="compute-total">0</span> vCPUs
                            </div>
                        </div>
                        <div class="breakdown-item">
                            <div class="breakdown-header">
                                <span>Memory</span>
                                <span id="memory-percent">0%</span>
                            </div>
                            <div class="breakdown-bar">
                                <div class="breakdown-fill memory" id="memory-fill" style="width: 0%"></div>
                            </div>
                            <div class="breakdown-legend">
                                <span id="memory-used">0</span> / <span id="memory-total">0</span> GB
                            </div>
                        </div>
                        <div class="breakdown-item">
                            <div class="breakdown-header">
                                <span>Storage</span>
                                <span id="storage-percent">0%</span>
                            </div>
                            <div class="breakdown-bar">
                                <div class="breakdown-fill storage" id="storage-fill" style="width: 0%"></div>
                            </div>
                            <div class="breakdown-legend">
                                <span id="storage-used">0</span> / <span id="storage-total">0</span> TB
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Notes -->
                <div class="notes-section">
                    <h3>Sizing Notes</h3>
                    <ul id="sizing-notes">
                        <li>Add workloads to see sizing recommendations</li>
                    </ul>
                </div>
            </div>
        </div>
    </main>

    <!-- Add Workload Modal -->
    <div class="modal-overlay" id="modal-overlay" onclick="closeModal()"></div>
    <div class="modal" id="add-workload-modal">
        <div class="modal-header">
            <h3 id="modal-title">Add Workload</h3>
            <button class="modal-close" onclick="closeModal()">&times;</button>
        </div>
        <div class="modal-body" id="modal-body">
            <!-- Content populated by JavaScript -->
        </div>
        <div class="modal-footer">
            <button class="btn btn-secondary" onclick="closeModal()">Cancel</button>
            <button class="btn btn-primary" onclick="addWorkload()">Add Workload</button>
        </div>
    </div>

    <!-- Analytics -->
    <script src="../analytics.js"></script>
    <script src="sizer.js"></script>
</body>
</html>
